---
import Base from "../layouts/BaseLayout.astro";
import StandingsTable from "../components/StandingsTable";
import InteractiveRankChart from "../components/InteractiveRankChart";
---
<Base title="Wurstliga – Tabelle">
  <section class="space-y-8">
    <div class="space-y-4">
      <div class="flex items-center justify-between">
        <h2 class="text-2xl font-semibold">Gesamtwertung</h2>
        <div id="last-update" class="text-sm text-zinc-400">
          Lade Update-Zeit...
        </div>
      </div>
      <StandingsTable client:load />
    </div>
    
    <div class="space-y-4">
      <h2 class="text-2xl font-semibold">Spieltag auswählen</h2>
      <div class="max-w-xs">
        <select 
          id="spieltag-select"
          class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2 text-zinc-100 focus:outline-none focus:border-brand"
        >
          <option value="">-- Spieltag wählen --</option>
          {Array.from({length: 34}, (_, i) => (
            <option value={i + 1}>Spieltag {i + 1}</option>
          ))}
        </select>
      </div>
    </div>
    
    <script>
      document.getElementById('spieltag-select')?.addEventListener('change', (e) => {
        const value = (e.target as HTMLSelectElement).value;
        if (value) {
          window.location.href = `/spieltag/${value}`;
        }
      });
      
      // Load last update time
      async function loadLastUpdate() {
        try {
          const response = await fetch(`https://marceldebruyker.github.io/wurstliga-data/season-2025-26/metadata.json?t=${Date.now()}`);
          const metadata = await response.json();
          
          if (metadata.last_update) {
            const updateTime = new Date(metadata.last_update);
            const germanTime = updateTime.toLocaleString('de-DE', {
              timeZone: 'Europe/Berlin',
              day: '2-digit',
              month: '2-digit', 
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            });
            
            document.getElementById('last-update').textContent = `Letztes Update: ${germanTime}`;
          }
        } catch (error) {
          console.error('Error loading last update:', error);
          document.getElementById('last-update').textContent = 'Update-Zeit nicht verfügbar';
        }
      }
      
      loadLastUpdate();
    </script>
    
    <div>
      <h2 class="text-2xl font-semibold">Rangentwicklung</h2>
      <div class="mt-4">
        <InteractiveRankChart client:load />
      </div>
    </div>
  </section>

</Base>